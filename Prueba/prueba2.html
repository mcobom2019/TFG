<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/master/dist/aframe-physics-system.min.js"></script>
  </head>
  <body>
    <a-scene physics="gravity: -9.8">
      <!-- Rig del jugador -->
      <a-entity id="rig" movement-controls position="0 1.6 0">
        <a-camera></a-camera>

        <!-- Controlador derecho -->
        <a-entity 
          oculus-touch-controls="hand: right" 
          teleport-controls="button: trigger; collisionEntities: [ground]" 
          sphere-collider="objects: .interactable">
        </a-entity>

        <!-- Controlador izquierdo con evento de agarre -->
        <a-entity 
          id="leftController"
          oculus-touch-controls="hand: left"
          grab-controls>
        </a-entity>
      </a-entity>

      <!-- Cielo -->
      <a-sky color="#87CEEB"></a-sky>

      <!-- Suelo -->
      <a-plane id="ground" position="0 0 0" rotation="-90 0 0" width="10" height="10" color="green" static-body></a-plane>

      <!-- Caja Roja -->
      <a-box class="interactable" position="-1 0.5 -3" rotation="0 45 0" color="red" dynamic-body></a-box>

      <!-- Esfera Azul -->
      <a-sphere class="interactable" position="1 1 -3" radius="0.5" color="blue" dynamic-body></a-sphere>

      <!-- Cilindro Amarillo (interactuable con botón X) -->
      <a-cylinder id="yellowCylinder" class="interactable" position="0 1 -4" radius="0.3" height="1" color="yellow" dynamic-body></a-cylinder>
    </a-scene>

    <script>
      AFRAME.registerComponent('grab-controls', {
        init: function () {
          let controller = this.el;
          let grabbedObject = null;

          controller.addEventListener('buttondown', function (event) {
            if (event.detail.id === 'X') { // Detecta botón "X"
              let intersectedEls = controller.components['sphere-collider'].intersectedEls;
              intersectedEls.forEach(el => {
                if (el.id === 'yellowCylinder') { // Si el objeto es el cilindro amarillo
                  grabbedObject = el;
                  grabbedObject.setAttribute('dynamic-body', 'mass: 0'); // Desactiva la física
                  grabbedObject.object3D.position.copy(controller.object3D.position);
                  grabbedObject.object3D.parent = controller.object3D; // Lo une a la mano
                }
              });
            }
          });

          controller.addEventListener('buttonup', function (event) {
            if (event.detail.id === 'X' && grabbedObject) { // Suelta el objeto
              grabbedObject.object3D.parent = null;
              grabbedObject.setAttribute('dynamic-body', 'mass: 1'); // Reactiva la física
              grabbedObject = null;
            }
          });
        }
      });
    </script>
  </body>
</html>
