<!DOCTYPE html>
<!-- Prueba de un detector de evento "click",
    que se dispara cuando pulsamos el botón del ratón sobre
    un componente. Se especifica el selector de los componentes
    sobre los que se dispara el evento.
-->
<html>
  <head>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script>
      AFRAME.registerComponent("detector", {
          init: function () {
              this.el.addEventListener("click", function () {
                  console.log("Detector: Botón pulsado");
              });
              this.el.addEventListener("obbcollisionstarted", function () {
                  console.log("Detector: Comienzo de colisión");
              });
              this.el.addEventListener("obbcollisionended", function () {
                  console.log("Detector: Fin de colisión");
              });
          }
      });
      
      // Componente escalador
      // Cambia la escala del objeto cuando se dispara un evento.

      AFRAME.registerComponent("escalador", {
          schema: {
              evento: { type: "string", default: "click" },
              factor: { type: "number", default: 2 },
          },
          multiple: true,
          init: function () {
              console.log("Escalador: init");
              let el = this.el;
              let self = this;
              let factor = this.data.factor;
              self.original = true;
              let escala_original = structuredClone(el.getAttribute('scale'));
              let escala_cambiada = {
                  x: escala_original.x * factor,
                  y: escala_original.y * factor,
                  z: escala_original.z * factor
              };
              el.addEventListener(this.data.evento, function () {
                  console.log("Escalador: Evento disparado");
                  if (self.original) {
                      el.setAttribute('scale', escala_cambiada);
                      self.original = false;
                  } else {
                      el.setAttribute('scale', escala_original);
                      self.original = true;
                  };
              });
          }
      });
    </script>
  </head>
  <body>
    <a-scene obb-collider="showColliders: true">
      <a-entity position="0 0.5 -4"
        geometry="primitive: box" material="color: blue"
        obb-collider detector
        escalador__click="evento: click; factor: 3"
        escalador__startcollision="evento: obbcollisionstarted; factor: 2"
        escalador__endcollision="evento: obbcollisionended; factor: 0.5">
      </a-entity>

      <a-entity position="-3 0.5 -4"
        geometry="primitive: box" material="color: red"
        obb-collider detector
        animation="property: position; to: 2.2 0.5 -4; dur: 6000;"
        escalador__click="evento: click; factor: 2"
        escalador__startcollision="evento: obbcollisionstarted; factor: 2"
        escalador__endcollision="evento: obbcollisionended; factor: 0.5">
      </a-entity>

      <a-entity position="0 0 0">
        <a-entity camera position="0 1.6 0" look-controls wasd-controls></a-entity>
        <a-entity cursor="rayOrigin: mouse"
          raycaster="objects: [detector]">
        </a-entity>
        <a-entity laser-controls="hand: right"
          raycaster="objects: [detector]; lineColor: blue;"></a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>