<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>A-Frame Mano Interactiva con Quest 3</title>
  <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-babia-components/dist/aframe-babia-components.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-super-hands-component@3.0.4/dist/aframe-super-hands.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>
  
  <script>
    // Componente para alternar el color de la caja al tocarla
    AFRAME.registerComponent('color-toggle', {
      init: function() {
        this.el.setAttribute('color', '#ff0000'); // Comienza con color rojo
        this.isRed = true;
        
        // Escuchar eventos de colisión de super-hands
        this.el.addEventListener('grab-start', this.toggleColor.bind(this));
        this.el.addEventListener('hover-start', this.toggleColor.bind(this));
      },
      
      toggleColor: function() {
        if (this.isRed) {
          this.el.setAttribute('color', '#00ff00'); // Cambia a verde
          this.isRed = false;
        } else {
          this.el.setAttribute('color', '#ff0000'); // Cambia a rojo
          this.isRed = true;
        }
      }
    });
  </script>
</head>
<body>
  <a-scene>
    <!-- Cámara y controles de manos -->
    <a-entity id="cameraRig" position="0 1.6 0">
      <a-entity id="head" camera wasd-controls look-controls></a-entity>
      
      <!-- Mano derecha con super-hands -->
      <a-entity
        id="rightHand"
        oculus-touch-controls="hand: right; model: true"
        oculus-quest-three="hand: right;"
        super-hands="
          colliderEvent: triggerdown;
          colliderEventProperty: pressed;
          colliderEndEvent: triggerup;
          colliderEndEventProperty: released;
          grabStartButtons: triggerdown;
          grabEndButtons: triggerup;
          stretchStartButtons: triggerdown;
          stretchEndButtons: triggerup;
        "
        raycaster="showLine: true; far: 2; objects: .interactable; lineColor: red; lineOpacity: 0.7"
      ></a-entity>
      
      <!-- Mano izquierda con super-hands -->
      <a-entity
        id="leftHand"
        oculus-touch-controls="hand: left; model: true"
        oculus-quest-three="hand: left;"
        super-hands="
          colliderEvent: triggerdown;
          colliderEventProperty: pressed;
          colliderEndEvent: triggerup;
          colliderEndEventProperty: released;
          grabStartButtons: triggerdown;
          grabEndButtons: triggerup;
          stretchStartButtons: triggerdown;
          stretchEndButtons: triggerup;
        "
        raycaster="showLine: true; far: 2; objects: .interactable; lineColor: blue; lineOpacity: 0.7"
      ></a-entity>
    </a-entity>
    
    <!-- Caja interactiva que cambia de color -->
    <a-box
      class="interactable"
      position="0 1 -1.5"
      width="0.5"
      height="0.5"
      depth="0.5"
      color-toggle
      hoverable
      grabbable
      stretchable
    ></a-box>
    
    <!-- Suelo -->
    <a-plane
      position="0 0 0"
      rotation="-90 0 0"
      width="10"
      height="10"
      color="#CCCCCC"
    ></a-plane>
    
    <!-- Iluminación -->
    <a-light type="ambient" intensity="0.5"></a-light>
    <a-light type="directional" position="0 1 1" intensity="0.8"></a-light>
    
    <!-- Cielo -->
    <a-sky color="#ECECEC"></a-sky>
  </a-scene>
</body>
</html>